<!DOCTYPE html>
<html>
<head>
    <title>Neon Defender Mobile</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        body { background: #050505; color: #fff; font-family: 'Segoe UI', sans-serif; margin: 0; overflow: hidden; touch-action: none; }
        canvas { display: block; background: #000; }
        #ui { position: absolute; top: 10px; left: 10px; font-size: 18px; pointer-events: none; z-index: 10; }
        
        /* Mobile Touch Controls */
        .touch-ctrl { position: absolute; bottom: 40px; border-radius: 50%; background: rgba(102, 252, 241, 0.1); border: 2px solid #66fcf1; display: flex; align-items: center; justify-content: center; user-select: none; }
        #stick-base { left: 40px; width: 120px; height: 120px; }
        #stick-head { width: 50px; height: 50px; background: #66fcf1; border-radius: 50%; position: absolute; }
        #fire-btn { right: 40px; width: 100px; height: 100px; font-weight: bold; color: #66fcf1; }
        #nuke-btn { right: 40px; bottom: 160px; width: 70px; height: 70px; border-color: #9b59b6; color: #9b59b6; font-size: 12px; }
        
        .overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.9); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; }
        button { background: transparent; border: 2px solid #66fcf1; color: #66fcf1; padding: 20px 40px; font-size: 24px; cursor: pointer; }
    </style>
</head>
<body>

    <div id="menu" class="overlay">
        <h1 style="color:#66fcf1">NEON DEFENDER</h1>
        <button onclick="start()">START GAME</button>
    </div>

    <div id="ui">SCORE: <span id="score">0</span> | HP: <span id="hp">100</span>%</div>

    <div id="stick-base" class="touch-ctrl"><div id="stick-head"></div></div>
    <div id="nuke-btn" class="touch-ctrl">NUKE</div>
    <div id="fire-btn" class="touch-ctrl">FIRE</div>

    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;

        let player = { x: canvas.width/2, y: canvas.height/2, size: 20, color: '#66fcf1', angle: 0 };
        let score = 0, health = 100, nukes = 0, playing = false;
        let bullets = [], enemies = [], stick = { x: 0, y: 0, active: false };

        // Joystick Logic
        const base = document.getElementById('stick-base');
        const head = document.getElementById('stick-head');

        base.addEventListener('touchstart', e => { stick.active = true; });
        window.addEventListener('touchmove', e => {
            if (!stick.active) return;
            let touch = e.touches[0];
            let rect = base.getBoundingClientRect();
            let centerX = rect.left + rect.width/2;
            let centerY = rect.top + rect.height/2;
            
            let angle = Math.atan2(touch.clientY - centerY, touch.clientX - centerX);
            let dist = Math.min(60, Math.hypot(touch.clientX - centerX, touch.clientY - centerY));
            
            stick.x = Math.cos(angle) * dist / 60;
            stick.y = Math.sin(angle) * dist / 60;
            player.angle = angle;
            
            head.style.transform = `translate(${stick.x * 40}px, ${stick.y * 40}px)`;
        });
        window.addEventListener('touchend', () => { 
            stick.active = false; stick.x = 0; stick.y = 0; 
            head.style.transform = `translate(0,0)`;
        });

        // Fire & Nuke Buttons
        let firing = false;
        document.getElementById('fire-btn').ontouchstart = () => firing = true;
        document.getElementById('fire-btn').ontouchend = () => firing = false;
        document.getElementById('nuke-btn').ontouchstart = () => { if(nukes > 0) useNuke(); };

        function start() { 
            playing = true; 
            document.getElementById('menu').style.display = 'none';
            spawn(); 
        }

        function useNuke() { nukes--; enemies = []; }

        function update() {
            if (!playing || health <= 0) return;

            player.x += stick.x * 5;
            player.y += stick.y * 5;

            if (firing && Date.now() % 150 < 20) {
                bullets.push({ x: player.x, y: player.y, vx: Math.cos(player.angle) * 12, vy: Math.sin(player.angle) * 12 });
            }

            enemies.forEach((en, i) => {
                let d = Math.hypot(player.x - en.x, player.y - en.y);
                en.x += (player.x - en.x) / d * 2;
                en.y += (player.y - en.y) / d * 2;
                if (d < player.size + 15) { health -= 10; enemies.splice(i, 1); }
            });

            bullets.forEach((b, bi) => {
                b.x += b.vx; b.y += b.vy;
                enemies.forEach((en, ei) => {
                    if (Math.hypot(b.x - en.x, b.y - en.y) < 20) {
                        score += 10; enemies.splice(ei, 1); bullets.splice(bi, 1);
                    }
                });
            });

            document.getElementById('score').textContent = score;
            document.getElementById('hp').textContent = Math.max(0, health);
            if(health <= 0) location.reload();
        }

        function draw() {
            ctx.fillStyle = "black"; ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.save();
            ctx.translate(player.x, player.y); ctx.rotate(player.angle);
            ctx.fillStyle = player.color;
            ctx.beginPath(); ctx.moveTo(25,0); ctx.lineTo(-15,15); ctx.lineTo(-15,-15); ctx.fill();
            ctx.restore();

            ctx.fillStyle = "white"; bullets.forEach(b => { ctx.beginPath(); ctx.arc(b.x, b.y, 4, 0, Math.PI*2); ctx.fill(); });
            ctx.fillStyle = "red"; enemies.forEach(en => { ctx.beginPath(); ctx.arc(en.x, en.y, 15, 0, Math.PI*2); ctx.fill(); });
        }

        function spawn() { if(playing) enemies.push({ x: Math.random()*canvas.width, y: -20 }); setTimeout(spawn, 1000); }
        function loop() { update(); draw(); requestAnimationFrame(loop); }
        loop();
    </script>
</body>
</html>
  
